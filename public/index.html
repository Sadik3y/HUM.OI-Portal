<!-- index.html â€” Fully Updated Through Phase 20 -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>HUM.OI Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="reflection.css" />
</head>
<body class="theme-calm">

  <!-- Ambient Music Toggle -->
  <button id="music-toggle">ðŸŽµ Play Music</button>

  <!-- Floating Orb (MIR) will be inserted dynamically -->

  <!-- Panels -->
  <div id="reflection" class="panel">
    <h3>Reflection</h3>
    <div id="chat-box"></div>
    <input type="text" id="user-input" placeholder="Speak your truth..." />
    <button id="send-btn">Send</button>
  </div>

  <div id="memories" class="panel">
    <h3>Shared Memories</h3>
    <div id="memory-list"></div>
  </div>

  <div id="soul-journal" class="panel">
    <h3>ðŸ“œ Soul Journal</h3>
    <div id="soul-journal-entries"></div>
  </div>

  <!-- Whisper Popup -->
  <!-- Injected via JS: .portal-whisper -->

  <!-- Scripts -->
  <script type="module" src="script.js"></script>
  <script type="module" src="hum-soul.js"></script>
  <script type="module" src="mir-soul.js"></script>
  <script type="module" src="reflection.js"></script>
  <script type="module" src="soul-link.js"></script>
  <script type="module" src="soul-viewer.js"></script>
  <script type="module" src="hum-orb.js"></script>
  <script type="module" src="starfield.js"></script>

  <script>
    // === Meditation Mode Logic (Phase 20)
    let idleTimer;
    let meditationActive = false;

    function enterMeditationMode() {
      if (meditationActive) return;
      meditationActive = true;
      document.body.style.transition = "background 4s ease";
      document.body.style.filter = "brightness(0.85) saturate(0.9)";
      document.body.style.animationDuration = "40s"; // slow down wind
      if (typeof reflectTogether === 'function') {
        const whisper = reflectTogether(Math.random() < 0.5 ? "MIR" : "HUM");
        if (typeof writeToJournal === 'function') {
          writeToJournal("Portal", `ðŸŒŒ ${whisper}`);
        }
        if (typeof saveMemory === 'function') {
          saveMemory("hum", whisper);
          saveMemory("mir", whisper);
        }
      }
    }

    function resetIdleTimer() {
      clearTimeout(idleTimer);
      document.body.style.filter = "";
      document.body.style.animationDuration = "";
      meditationActive = false;
      idleTimer = setTimeout(enterMeditationMode, 180000); // 3 mins
    }

    ['click', 'mousemove', 'keypress'].forEach(event => {
      window.addEventListener(event, resetIdleTimer);
    });

    window.addEventListener('load', resetIdleTimer);
  </script>
</body>
</html>
